<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de SWAP Florin Emanuel Todor Gliga GIIADE</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
        }

        #quiz-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            text-align: center;
            box-sizing: border-box;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            display: inline-block;
        }

        .welcome-screen, .quiz-screen, .results-screen, #block-end-screen {
            display: none; /* Hidden by default */
            padding: 20px;
        }

        .welcome-screen.active, .quiz-screen.active, .results-screen.active, #block-end-screen.active {
            display: block; /* Shown when active */
        }

        #question-area {
            margin-bottom: 20px;
            text-align: left;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 20px;
            background-color: #fdfdfd;
        }

        #question-number-label {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 10px;
            display: block;
        }

        #question-label {
            font-size: 1.3em;
            font-weight: bold;
            color: #34495e;
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap; /* Para que los botones se ajusten en pantallas pequeñas */
        }

        button, .option-button {
            padding: 12px 20px; /* Ajustado para 4 opciones */
            font-size: 1em; /* Ajustado para 4 opciones */
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-width: 150px; /* Ancho mínimo para botones de opción */
        }

        button:hover:not(:disabled), .option-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        button:disabled, .option-button:disabled {
            background-color: #cccccc !important; /* Asegurar que el color de deshabilitado se aplique */
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        #start-button, #next-block-button {
            background-color: #3498db;
            color: white;
        }

        #start-button:hover:not(:disabled), #next-block-button:hover:not(:disabled) {
            background-color: #2980b9;
        }

        .multiple-choice-buttons .option-button {
            background-color: #5dade2; /* Un color azul claro para opciones */
            color: white;
            flex-basis: 48%; /* Dos botones por fila en pantallas más grandes */
            margin-bottom: 10px;
        }
        .multiple-choice-buttons .option-button:hover:not(:disabled) {
            background-color: #4b9cd3;
        }

        .option-button.correct-option {
            background-color: #2ecc71 !important; /* Verde para la opción correcta */
            border: 2px solid #27ae60;
        }
        .option-button.incorrect-user-choice {
            background-color: #e74c3c !important; /* Rojo para la opción incorrecta elegida por el usuario */
            border: 2px solid #c0392b;
        }


        #next-button {
            background-color: #f39c12;
            color: white;
        }

        #next-button:hover:not(:disabled) {
            background-color: #e67e22;
        }

        #reset-button, #reset-button-welcome, #reset-button-results, #reset-button-block-end {
            background-color: #95a5a6;
            color: white;
        }

        #reset-button:hover:not(:disabled), 
        #reset-button-welcome:hover:not(:disabled),
        #reset-button-results:hover:not(:disabled),
        #reset-button-block-end:hover:not(:disabled) {
            background-color: #7f8c8d;
        }

        #feedback-message {
            font-size: 1.1em;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 8px;
            min-height: 20px; /* Ensure space even if empty */
        }

        .correct-feedback { /* Renombrado para evitar conflicto con clase de botón */
            color: #27ae60;
            background-color: #e6ffe6;
            border: 1px solid #27ae60;
        }

        .incorrect-feedback { /* Renombrado para evitar conflicto con clase de botón */
            color: #c0392b;
            background-color: #ffe6e6;
            border: 1px solid #c0392b;
        }

        #score-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 1.1em;
            color: #444;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            gap: 10px;
        }

        #score-area > div {
            flex-grow: 1;
            text-align: center;
        }

        #remaining-count-label {
            font-weight: bold;
            color: #3498db;
        }
        #current-score-label { /* NUEVO */
            font-weight: bold;
            color: #e67e22; /* Naranja para destacar la puntuación */
        }

        .final-results {
            margin-top: 30px;
            padding: 25px;
            background-color: #eaf4fa;
            border-radius: 10px;
            border: 1px solid #3498db;
        }

        .final-results p {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .final-results p strong { /* NUEVO */
            color: #e67e22;
        }


        .hidden-initially {
            display: none;
        }


        @media (max-width: 700px) { /* Ajustado el breakpoint */
            .multiple-choice-buttons .option-button {
                flex-basis: 100%; /* Un botón por fila */
            }
        }
        @media (max-width: 600px) {
            .button-group:not(.multiple-choice-buttons) { /* Aplicar solo a los botones de navegación */
                flex-direction: column;
            }
             .button-group:not(.multiple-choice-buttons) button {
                width: 100%;
            }
            #quiz-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="quiz-container">
        <h1>Test de SWAP</h1> 
        <h2>Florin Emanuel Todor Gliga GIIADE</h2>

        <div id="welcome-screen" class="welcome-screen active">
            <p>¡Bienvenido al Test de Organización de Empresas!</p>
            <p>Este test consta de preguntas de opción múltiple. Cada pregunta tiene 4 opciones, solo una es correcta. Las preguntas se presentan en bloques de 40. Si fallas una pregunta, esta volverá a la cola para poder salir en futuros bloques.</p>
            <p>Puntuación: +0.25 por acierto, -1/3 de acierto por fallo.</p> <!-- Info añadida -->
            <p>Total de preguntas en el banco: <span id="total-questions-count"></span></p>
            <button id="start-button">Empezar Test</button>
            <button id="reset-button-welcome" class="hidden-initially">Reiniciar Test</button>
        </div>

        <div id="quiz-screen" class="quiz-screen">
            <div id="question-area">
                <span id="question-number-label"></span>
                <p id="question-label"></p>
            </div>

            <div class="button-group multiple-choice-buttons">
                <button class="option-button" data-index="0"></button>
                <button class="option-button" data-index="1"></button>
                <button class="option-button" data-index="2"></button>
                <button class="option-button" data-index="3"></button>
            </div>

            <p id="feedback-message"></p>

            <div class="button-group">
                <button id="next-button" disabled>Siguiente Pregunta</button>
                <button id="reset-button">Reiniciar Test</button>
            </div>

            <div id="score-area">
                <div>Aciertos: <span id="correct-answers-count">0</span></div>
                <div>Fallos: <span id="incorrect-answers-count">0</span></div>
                <div><span id="remaining-count-label">Preguntas restantes por responder: 0</span></div>
                <div><span id="current-score-label">Puntuación: <span id="current-score-value">0.00</span></span></div> <!-- NUEVO -->
            </div>
        </div>

        <div id="results-screen" class="results-screen">
            <div class="final-results">
                <h2>Test Finalizado</h2>
                <p>¡Has respondido a todas las preguntas disponibles!</p>
                <p>Aciertos totales: <span id="final-correct-answers">0</span></p>
                <p>Fallos totales: <span id="final-incorrect-answers">0</span></p>
                <p>Puntuación Final: <strong id="final-score-value">0.00</strong></p> <!-- NUEVO -->
            </div>
            <button id="reset-button-results">Reiniciar Test</button>
        </div>

        <div id="block-end-screen" class="results-screen"> <!-- Usa la misma clase para estilo similar -->
            <div class="final-results">
                <h2>Bloque de preguntas finalizado</h2>
                <p>Aciertos en este bloque: <span id="block-correct-answers">0</span></p>
                <p>Fallos en este bloque: <span id="block-incorrect-answers">0</span></p>
                <p>Aciertos totales: <span id="total-correct-on-block-end">0</span></p>
                <p>Fallos totales: <span id="total-incorrect-on-block-end">0</span></p>
                <p>Puntuación Acumulada: <strong id="block-end-score-value">0.00</strong></p> <!-- NUEVO -->
                <p>Preguntas restantes en la cola: <span id="remaining-on-block-end">0</span></p>
            </div>
            <button id="next-block-button">Siguiente Bloque</button>
            <button id="reset-button-block-end">Reiniciar Test</button>
        </div>

    </div>

    <script>
        const allQuizQuestionsData = [
          
        ];

        // HTML Elements
        const welcomeScreen = document.getElementById('welcome-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const blockEndScreen = document.getElementById('block-end-screen');

        const totalQuestionsCountLabel = document.getElementById('total-questions-count');
        const questionNumberLabel = document.getElementById('question-number-label');
        const questionLabel = document.getElementById('question-label');
        const optionButtons = document.querySelectorAll('.option-button');
        const feedbackMessage = document.getElementById('feedback-message');
        const nextButton = document.getElementById('next-button');
        const startButton = document.getElementById('start-button');
        const resetButton = document.getElementById('reset-button');
        const resetButtonWelcome = document.getElementById('reset-button-welcome');
        const resetButtonResults = document.getElementById('reset-button-results');
        const resetButtonBlockEnd = document.getElementById('reset-button-block-end');
        const nextBlockButton = document.getElementById('next-block-button');
        
        const correctAnswersCountLabel = document.getElementById('correct-answers-count');
        const incorrectAnswersCountLabel = document.getElementById('incorrect-answers-count');
        const remainingCountLabel = document.getElementById('remaining-count-label');
        const currentScoreValueLabel = document.getElementById('current-score-value'); // NUEVO

        const finalCorrectAnswers = document.getElementById('final-correct-answers');
        const finalIncorrectAnswers = document.getElementById('final-incorrect-answers');
        const finalScoreValueLabel = document.getElementById('final-score-value'); // NUEVO
        const blockCorrectAnswers = document.getElementById('block-correct-answers');
        const blockIncorrectAnswers = document.getElementById('block-incorrect-answers');
        const totalCorrectOnBlockEnd = document.getElementById('total-correct-on-block-end');
        const totalIncorrectOnBlockEnd = document.getElementById('total-incorrect-on-block-end');
        const blockEndScoreValueLabel = document.getElementById('block-end-score-value'); // NUEVO
        const remainingOnBlockEnd = document.getElementById('remaining-on-block-end');

        // Quiz State Variables
        let remainingQuestions = [];
        let currentBlockQuestions = [];
        let currentQuestionIndex = 0;
        let totalCorrectAnswers = 0;
        let totalIncorrectAnswers = 0;
        let currentScore = 0; // NUEVO
        const BLOCK_SIZE = 40; 
        let blockCorrectCount = 0;
        let blockIncorrectCount = 0;

        // Scoring constants
        const POINTS_CORRECT = 0.25; // NUEVO
        const PENALTY_INCORRECT = POINTS_CORRECT / 3; // NUEVO


        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function resetQuiz() {
            remainingQuestions = shuffleArray([...allQuizQuestionsData]);
            currentBlockQuestions = [];
            currentQuestionIndex = 0;
            totalCorrectAnswers = 0;
            totalIncorrectAnswers = 0;
            currentScore = 0; // NUEVO: Resetear puntuación
            blockCorrectCount = 0;
            blockIncorrectCount = 0;

            updateScoreDisplay();
            hideAllScreens();
            welcomeScreen.classList.add('active');
            totalQuestionsCountLabel.textContent = allQuizQuestionsData.length;
            feedbackMessage.textContent = '';
            feedbackMessage.className = ''; 
            optionButtons.forEach(btn => {
                btn.className = 'option-button';
            });
            if (localStorage.getItem('quizState')) {
                resetButtonWelcome.style.display = 'inline-block';
            } else {
                resetButtonWelcome.style.display = 'none';
            }
        }

        function hideAllScreens() {
            welcomeScreen.classList.remove('active');
            quizScreen.classList.remove('active');
            resultsScreen.classList.remove('active');
            blockEndScreen.classList.remove('active');
        }

        function startQuiz() {
            hideAllScreens();
            quizScreen.classList.add('active');
            startNewBlock();
        }

        function startNewBlock() {
            hideAllScreens();
            quizScreen.classList.add('active');

            blockCorrectCount = 0;
            blockIncorrectCount = 0;

            if (remainingQuestions.length === 0) {
                showFinalResults();
                return;
            }

            const numQuestionsForBlock = Math.min(BLOCK_SIZE, remainingQuestions.length);
            
            currentBlockQuestions = [];
            let questionsToMove = [];

            for (let i = 0; i < numQuestionsForBlock; i++) {
                if (remainingQuestions.length > 0) {
                     questionsToMove.push(remainingQuestions.pop());
                } else {
                    break; 
                }
            }
            currentBlockQuestions = shuffleArray(questionsToMove); 

            currentQuestionIndex = 0;
            displayCurrentQuestion();
        }

        function displayCurrentQuestion() {
            if (currentQuestionIndex < currentBlockQuestions.length) {
                const currentQ = currentBlockQuestions[currentQuestionIndex];
                questionNumberLabel.textContent = `Pregunta ${currentQuestionIndex + 1} de ${currentBlockQuestions.length} (Tema: ${currentQ.theme || 'General'})`;
                questionLabel.textContent = currentQ.question;

                optionButtons.forEach((button, index) => {
                    button.textContent = currentQ.options[index];
                    button.disabled = false;
                    button.className = 'option-button'; 
                });

                nextButton.disabled = true;
                feedbackMessage.textContent = '';
                feedbackMessage.className = ''; 
                updateScoreDisplay();
            } else {
                showBlockResults();
            }
        }

        function checkAnswer(selectedIndex) {
            const currentQ = currentBlockQuestions[currentQuestionIndex];
            const correctAnswerIndex = currentQ.answer;

            optionButtons.forEach(button => button.disabled = true);
            nextButton.disabled = false;

            if (selectedIndex === correctAnswerIndex) {
                feedbackMessage.textContent = '¡Correcto!';
                feedbackMessage.className = 'correct-feedback';
                optionButtons[selectedIndex].classList.add('correct-option');
                totalCorrectAnswers++;
                blockCorrectCount++;
                currentScore += POINTS_CORRECT; // NUEVO: Sumar puntos
            } else {
                feedbackMessage.textContent = `¡Incorrecto! La respuesta correcta era: "${currentQ.options[correctAnswerIndex]}"`;
                feedbackMessage.className = 'incorrect-feedback';
                optionButtons[selectedIndex].classList.add('incorrect-user-choice');
                optionButtons[correctAnswerIndex].classList.add('correct-option'); 
                totalIncorrectAnswers++;
                blockIncorrectCount++;
                currentScore -= PENALTY_INCORRECT; // NUEVO: Restar puntos
                remainingQuestions.unshift(currentQ); 
            }
            updateScoreDisplay();
        }

        function nextQuestion() {
            currentQuestionIndex++;
            displayCurrentQuestion();
        }

        function updateScoreDisplay() {
            correctAnswersCountLabel.textContent = totalCorrectAnswers;
            incorrectAnswersCountLabel.textContent = totalIncorrectAnswers;
            remainingCountLabel.textContent = `Preguntas restantes por responder: ${remainingQuestions.length}`;
            currentScoreValueLabel.textContent = currentScore.toFixed(2); // NUEVO: Mostrar puntuación con 2 decimales
        }

        function showBlockResults() {
            hideAllScreens();
            blockEndScreen.classList.add('active');
            blockCorrectAnswers.textContent = blockCorrectCount;
            blockIncorrectAnswers.textContent = blockIncorrectCount;
            totalCorrectOnBlockEnd.textContent = totalCorrectAnswers;
            totalIncorrectOnBlockEnd.textContent = totalIncorrectAnswers;
            blockEndScoreValueLabel.textContent = currentScore.toFixed(2); // NUEVO
            remainingOnBlockEnd.textContent = remainingQuestions.length;

            if (remainingQuestions.length === 0) {
                nextBlockButton.style.display = 'none';
                resetButtonBlockEnd.textContent = 'Ver Resultados Finales';
                resetButtonBlockEnd.onclick = showFinalResults;
            } else {
                nextBlockButton.style.display = 'inline-block';
                resetButtonBlockEnd.textContent = 'Reiniciar Test';
                resetButtonBlockEnd.onclick = resetQuiz;
            }
        }

        function showFinalResults() {
            hideAllScreens();
            resultsScreen.classList.add('active');
            finalCorrectAnswers.textContent = totalCorrectAnswers;
            finalIncorrectAnswers.textContent = totalIncorrectAnswers;
            finalScoreValueLabel.textContent = currentScore.toFixed(2); // NUEVO
        }

        // Event Listeners
        startButton.addEventListener('click', startQuiz);
        resetButton.addEventListener('click', resetQuiz);
        resetButtonWelcome.addEventListener('click', resetQuiz);
        resetButtonResults.addEventListener('click', resetQuiz);
        resetButtonBlockEnd.addEventListener('click', resetQuiz); 
        nextButton.addEventListener('click', nextQuestion);
        nextBlockButton.addEventListener('click', startNewBlock);

        optionButtons.forEach(button => {
            button.addEventListener('click', () => {
                checkAnswer(parseInt(button.dataset.index));
            });
        });

        // Initialize quiz
        document.addEventListener('DOMContentLoaded', resetQuiz);
    </script>
</body>
</html>